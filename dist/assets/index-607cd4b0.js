var I=Object.defineProperty;var B=(s,t,e)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(B(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function p(s,t,e){return(1-e)*s+e*t}class R{constructor(t,e){o(this,"side");o(this,"wrist");o(this,"fingers",{});o(this,"joints",[]);o(this,"targetState",{wristRot:new THREE.Euler(0,0,0),fingerCurls:{thumb:0,index:0,middle:0,ring:0,pinky:0}});o(this,"currentState",{wristRot:new THREE.Euler(0,0,0),fingerCurls:{thumb:0,index:0,middle:0,ring:0,pinky:0}});o(this,"animState","IDLE");o(this,"animStartTime",0);this.side=t,this.buildHand(e)}buildHand(t){console.log(`[RobotHand] Building ${this.side} hand...`);const e=new THREE.MeshStandardMaterial({color:12632256,roughness:.4,metalness:.8,side:THREE.DoubleSide}),i=new THREE.MeshStandardMaterial({color:3355443,roughness:.7,metalness:.5});this.wrist=new THREE.Group;const n=this.side==="right"?1.5:-1.5;this.wrist.position.set(n,-2,0),this.side==="left"&&(this.wrist.scale.x=-1);const r=new THREE.SphereGeometry(.5,16,16),d=new THREE.MeshBasicMaterial({color:16711680}),E=new THREE.Mesh(r,d);this.wrist.add(E),t.add(this.wrist),this.joints.push(this.wrist);const g=new THREE.Mesh(new THREE.BoxGeometry(2.5,3,.5),e);g.position.y=1.5,this.wrist.add(g),[{name:"thumb",x:1.5,y:.5,z:0,rotZ:-.5,scale:1.2},{name:"index",x:1,y:3,z:0,rotZ:0,scale:1},{name:"middle",x:.3,y:3.2,z:0,rotZ:0,scale:1.05},{name:"ring",x:-.4,y:3,z:0,rotZ:0,scale:1},{name:"pinky",x:-1.1,y:2.8,z:0,rotZ:0,scale:.9}].forEach(l=>{const m=new THREE.Group;m.position.set(l.x,l.y,l.z),m.rotation.z=l.rotZ,this.wrist.add(m);const S=[];let b=m;const x=[.8,.7,.6];x.forEach((z,H)=>{const u=this.createSegment(z*l.scale,e,i);H>0&&(u.joint.position.y=x[H-1]*l.scale/2),b.add(u.joint),b=u.bone,S.push(u.joint),this.joints.push(u.joint)}),this.fingers[l.name]={root:m,segments:S}})}createSegment(t,e,i){const n=new THREE.Group,r=new THREE.Mesh(new THREE.SphereGeometry(.25,16,16),i);n.add(r);const d=new THREE.Mesh(new THREE.CylinderGeometry(.2,.15,t,16),e);return d.position.y=t/2,n.add(d),{joint:n,bone:d}}setFace(t,e){this.targetState.fingerCurls[t]=e}setWrist(t,e,i){this.targetState.wristRot.x=t,this.targetState.wristRot.y=e,this.targetState.wristRot.z=i}poseHand(t){this.animState="POSE",this.setFace("thumb",t.thumb),this.setFace("index",t.index),this.setFace("middle",t.middle),this.setFace("ring",t.ring),this.setFace("pinky",t.pinky),this.setWrist(-.2,0,0)}triggerAnimation(t){this.animState=t,this.animStartTime=Date.now()}update(t){this.updateLogic(t),this.updateLerp();const e=this.currentState.wristRot;(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))&&(console.error(`[RobotHand] NaN Detected! Side: ${this.side}`,e),this.currentState.wristRot.set(0,0,0)),this.applyToMesh()}updateLogic(t){if(this.animState==="IDLE"){const e=Math.sin(t*1.5)*.05;this.setWrist(e*.5,0,e),["thumb","index","middle","ring","pinky"].forEach(i=>this.setFace(i,.1+Math.sin(t+(i==="thumb"?0:2))*.05))}else if(this.animState==="HELLO"){const e=Math.sin(t*10);this.setWrist(-.2,0,e*.5),["thumb","index","middle","ring","pinky"].forEach(i=>this.setFace(i,0))}else if(this.animState==="YES"){const e=Math.sin(t*8);this.setWrist(e*.5-.2,0,0),["thumb","index","middle","ring","pinky"].forEach(i=>this.setFace(i,1.5))}else if(this.animState==="NO"){const e=Math.sin(t*10);this.setWrist(-.2,0,e*.3),["thumb","index","middle","ring","pinky"].forEach(i=>this.setFace(i,0))}}updateLerp(){this.currentState.wristRot.x=p(this.currentState.wristRot.x,this.targetState.wristRot.x,.15),this.currentState.wristRot.y=p(this.currentState.wristRot.y,this.targetState.wristRot.y,.15),this.currentState.wristRot.z=p(this.currentState.wristRot.z,this.targetState.wristRot.z,.15);for(const e of["thumb","index","middle","ring","pinky"])this.currentState.fingerCurls[e]=p(this.currentState.fingerCurls[e],this.targetState.fingerCurls[e],.15)}applyToMesh(){this.wrist.rotation.copy(this.currentState.wristRot);for(const t of["thumb","index","middle","ring","pinky"]){const e=this.currentState.fingerCurls[t],i=this.fingers[t];i&&i.segments.forEach((n,r)=>{n.rotation.x=e})}}}const v={a:{thumb:.1,index:1.5,middle:1.5,ring:1.5,pinky:1.5},b:{thumb:1.5,index:0,middle:0,ring:0,pinky:0},c:{thumb:.5,index:.5,middle:.5,ring:.5,pinky:.5},d:{thumb:1.5,index:0,middle:1.5,ring:1.5,pinky:1.5},e:{thumb:1.5,index:1.5,middle:1.5,ring:1.5,pinky:1.5},f:{thumb:1.5,index:1.2,middle:0,ring:0,pinky:0},g:{thumb:.5,index:.2,middle:1.5,ring:1.5,pinky:1.5},h:{thumb:1.5,index:.2,middle:.2,ring:1.5,pinky:1.5},i:{thumb:1.4,index:1.5,middle:1.5,ring:1.5,pinky:0},j:{thumb:1.4,index:1.5,middle:1.5,ring:1.5,pinky:0},k:{thumb:.5,index:0,middle:.5,ring:1.5,pinky:1.5},l:{thumb:0,index:0,middle:1.5,ring:1.5,pinky:1.5},m:{thumb:1.2,index:1.2,middle:1.2,ring:1.2,pinky:1.5},n:{thumb:1.2,index:1.2,middle:1.2,ring:1.5,pinky:1.5},o:{thumb:1.2,index:1.2,middle:1.2,ring:1.2,pinky:1.2},p:{thumb:.5,index:.5,middle:0,ring:1.5,pinky:1.5},q:{thumb:.5,index:.5,middle:1.5,ring:1.5,pinky:1.5},r:{thumb:1.5,index:.1,middle:.1,ring:1.5,pinky:1.5},s:{thumb:1.2,index:1.4,middle:1.4,ring:1.4,pinky:1.4},t:{thumb:.5,index:1.2,middle:1.5,ring:1.5,pinky:1.5},u:{thumb:1.5,index:0,middle:0,ring:1.5,pinky:1.5},v:{thumb:1.5,index:0,middle:0,ring:1.5,pinky:1.5},w:{thumb:1.2,index:0,middle:0,ring:0,pinky:1.5},x:{thumb:1.2,index:.8,middle:1.5,ring:1.5,pinky:1.5},y:{thumb:0,index:1.5,middle:1.5,ring:1.5,pinky:0},z:{thumb:1.2,index:0,middle:1.5,ring:1.5,pinky:1.5}};class F{constructor(t){o(this,"container");o(this,"scene");o(this,"camera");o(this,"renderer");o(this,"clock");o(this,"leftHand");o(this,"rightHand");o(this,"animationQueue",[]);o(this,"isAnimating",!1);o(this,"currentAnimationEnd",0);o(this,"lastLogTime",0);const e=document.getElementById(t);if(!e)throw new Error(`Container ${t} not found`);this.container=e,this.clock=new THREE.Clock,this.initScene(),this.leftHand=new R("left",this.scene),this.rightHand=new R("right",this.scene),window.addEventListener("resize",()=>this.onWindowResize(),!1)}initScene(){this.scene=new THREE.Scene,this.scene.fog=new THREE.FogExp2(1120295,.05),this.camera=new THREE.PerspectiveCamera(60,this.container.clientWidth/this.container.clientHeight,.1,100),this.camera.position.set(0,2,15),this.camera.lookAt(0,0,0),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),console.log(`[RobotAvatar] Canvas Size: ${this.container.clientWidth}x${this.container.clientHeight}`),console.log("[RobotAvatar] Renderer DOM Element:",this.renderer.domElement);const t=new THREE.DirectionalLight(16777215,1.2);t.position.set(5,10,7),t.castShadow=!0,this.scene.add(t);const e=new THREE.SpotLight(43775,.8);e.position.set(-5,5,5),this.scene.add(e);const i=new THREE.AmbientLight(4210752);this.scene.add(i);const n=new THREE.BoxGeometry(1,1,1),r=new THREE.MeshBasicMaterial({color:65280,wireframe:!0}),d=new THREE.Mesh(n,r);d.position.set(0,0,0),this.scene.add(d);const E=new THREE.PlaneGeometry(20,20),g=new THREE.MeshBasicMaterial({color:5570560,side:THREE.DoubleSide}),w=new THREE.Mesh(E,g);w.position.z=-5,this.scene.add(w),this.renderer.setClearColor(65535,1),console.log("DEBUG: Scene Init Complete. Camera at (0,2,15). Red Plane at z=-5."),console.log(`DEBUG: Scene has ${this.scene.children.length} children`),this.renderer.render(this.scene,this.camera),console.log("DEBUG: Initial render complete")}onWindowResize(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}triggerAnimation(t){if(console.log(`[Avatar] Request: ${t}`),["HELLO","YES","NO","IDLE"].includes(t)||t==="IDLE")this.animationQueue.push(t);else{const i=t.toLowerCase().replace(/[^a-z]/g,"");for(const n of i)this.animationQueue.push(`CHAR_${n}`)}}animate(){const t=this.clock.getElapsedTime(),e=Date.now();if(Math.floor(t)%3===0&&Math.floor(t)!==this.lastLogTime){if(console.log(`[Avatar] Time: ${t.toFixed(1)}`),this.leftHand&&this.leftHand.wrist){const i=this.leftHand.wrist.position;console.log(`[LeftHand] Pos: ${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)} | Scale: ${this.leftHand.wrist.scale.x}`)}if(this.rightHand&&this.rightHand.wrist){const i=this.rightHand.wrist.position;console.log(`[RightHand] Pos: ${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)}`)}this.lastLogTime=Math.floor(t)}if(!this.isAnimating&&this.animationQueue.length>0){const i=this.animationQueue.shift();i&&this.startAnimation(i)}this.isAnimating&&e>this.currentAnimationEnd&&(this.isAnimating=!1),this.leftHand.update(t),this.rightHand.update(t),this.renderer.render(this.scene,this.camera)}startAnimation(t){console.log(`[Avatar] Playing: ${t}`),this.isAnimating=!0;let e=3e3;if(t.startsWith("CHAR_")){const i=t.split("_")[1],n=v[i];n&&(this.rightHand.poseHand(n),this.leftHand.triggerAnimation("IDLE"),e=800)}else this.leftHand.triggerAnimation(t),this.rightHand.triggerAnimation(t);this.currentAnimationEnd=Date.now()+e}}let c=null;function h(s){const t=document.getElementById("transcript");t&&(t.innerText=s)}function $(s){if("speechSynthesis"in window){const t=new SpeechSynthesisUtterance(s);window.speechSynthesis.speak(t)}}let a=null,f=!1;function D(){return document.getElementById("mic-status")}function y(s){const t=D(),e=document.getElementById("mic-toggle-btn");t&&(s?t.classList.add("bg-red-500","animate-pulse","shadow-red-500/50"):t.classList.remove("bg-red-500","animate-pulse","shadow-red-500/50")),e&&(e.textContent=s?"Stop Listening":"Start Listening",e.classList.toggle("bg-red-600",s),e.classList.toggle("bg-blue-600",!s))}function M(){if(a)return a;const s=window.SpeechRecognition||window.webkitSpeechRecognition;return s?(a=new s,a.continuous=!0,a.lang="en-US",a.interimResults=!1,a.maxAlternatives=1,a.onstart=()=>{h("System: Mic Active."),f=!0,y(!0)},a.onend=()=>{f=!1,y(!1),h("System: Mic Idle.")},a.onerror=t=>{console.error("Speech Error",t.error),t.error==="not-allowed"?h("Error: Mic Access Denied."):t.error==="network"?(h("Error: Network/API unreachable."),h("Info: Check connection or use Chrome.")):h(`Error: ${t.error}`),f=!1,y(!1)},a.onresult=t=>{const e=t.results.length-1,i=t.results[e][0].transcript.trim().toLowerCase();console.log("Heard:",i),h(`You said: "${i}"`),c&&i.split(/\s+/).forEach(r=>{const d=r.replace(/[^a-z0-9]/g,"");d.length>0&&(c==null||c.triggerAnimation(d.toUpperCase()))})}):h("System: Web Speech API not supported."),a}function G(){if(a||M(),!!a)if(f)a.stop();else try{a.start()}catch(s){console.warn("Start failed",s)}}const k=document.getElementById("mic-toggle-btn");k&&k.addEventListener("click",G);function A(){const s=document.getElementById("chat-input"),t=s.value.trim().toLowerCase();t&&(console.log("Chat Input:",t),h(`You typed: "${s.value}"`),$(s.value),c&&t.split(/\s+/).forEach(i=>{const n=i.replace(/[^a-z0-9]/g,"");n.length>0&&(c==null||c.triggerAnimation(n.toUpperCase()))}),s.value="")}function W(){console.log("[Main] Starting Game..."),c=new F("canvas-container"),console.log("[Main] RobotAvatar Created"),M(),C(),console.log("[Main] Main Loop Started")}function C(){requestAnimationFrame(C),c&&c.animate()}const L=document.getElementById("chat-btn");L&&L.addEventListener("click",A);const T=document.getElementById("chat-input");T&&T.addEventListener("keypress",s=>{s.key==="Enter"&&A()});console.log("[Main] Page Loaded. Auto-starting...");W();
